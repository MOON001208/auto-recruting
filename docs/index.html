<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Scout Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .filter-btn {
            transition: all 0.2s ease;
        }

        .filter-btn.active {
            transform: scale(1.05);
        }

        .job-card {
            transition: all 0.3s ease;
        }

        .job-card.hidden {
            display: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fadeIn {
            animation: fadeIn 0.3s ease-out;
        }
    </style>
    <script defer>
        // ì¹´í…Œê³ ë¦¬ í‚¤ì›Œë“œ ë§¤í•‘ (config.pyì™€ ë™ì¼)
        const CATEGORY_KEYWORDS = {
            "Data": ["ë°ì´í„° ë¶„ì„", "data analyst", "ë°ì´í„° ì—”ì§€ë‹ˆì–´", "data scientist", "ë¨¸ì‹ ëŸ¬ë‹", "ai", "AI AGENT"],
            "Accounting": ["íšŒê³„", "ì¬ë¬´", "ì„¸ë¬´", "ê²°ì‚°"],
            "HR": ["ì¸ì‚¬", "hrm", "hrd", "ì´ë¬´", "ì±„ìš©"]
        };

        let allJobs = [];
        let currentCategory = 'all';
        let currentPlatform = 'all';
        let showOnlyDeadlineToday = false;
        let showOnlyNew = false;

        // í”Œë«í¼ ëª©ë¡ (site í•„ë“œ ê¸°ì¤€)
        const PLATFORMS = {
            'all': { name: 'ì „ì²´', icon: 'ğŸŒ' },
            'JobKorea': { name: 'ì¡ì½”ë¦¬ì•„', icon: 'ğŸŸ¦' },
            'Linkareer': { name: 'ë§ì»¤ë¦¬ì–´', icon: 'ğŸŸ©' },
            'Incruit': { name: 'ì¸í¬ë£¨íŠ¸', icon: 'ğŸŸ§' },
            'Saramin': { name: 'ì‚¬ëŒì¸', icon: 'ğŸŸ¥' },
            'Wanted': { name: 'ì›í‹°ë“œ', icon: 'ğŸŸª' }
        };

        async function loadJobs() {
            try {
                const response = await fetch('jobs.json');
                allJobs = await response.json();

                // URL íŒŒë¼ë¯¸í„°ì—ì„œ ì¹´í…Œê³ ë¦¬ ë° í•„í„° í™•ì¸
                const urlParams = new URLSearchParams(window.location.search);
                const categoryParam = urlParams.get('category');
                if (categoryParam) {
                    currentCategory = categoryParam.toLowerCase();
                }
                const filterParam = urlParams.get('filter');
                if (filterParam === 'deadline') {
                    showOnlyDeadlineToday = true;
                } else if (filterParam === 'new') {
                    showOnlyNew = true;
                }

                const platformParam = urlParams.get('platform');
                if (platformParam) {
                    currentPlatform = platformParam;
                }

                renderJobs(allJobs);
                updateFilterButtons();
                updateStats();
            } catch (e) {
                console.error("Failed to load jobs", e);
                document.getElementById('job-list').innerHTML = `<p class="text-red-500">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${e}</p>`;
            }
        }

        function getJobCategory(job) {
            const keyword = (job.hidden_keyword || '').toLowerCase();

            for (const [category, keywords] of Object.entries(CATEGORY_KEYWORDS)) {
                if (keywords.some(kw => keyword.includes(kw.toLowerCase()))) {
                    return category.toLowerCase();
                }
            }
            return 'other';
        }

        function filterByCategory(category) {
            currentCategory = category;

            // URL ì—…ë°ì´íŠ¸ (íˆìŠ¤í† ë¦¬ì— ì¶”ê°€)
            const url = new URL(window.location);
            if (category === 'all') {
                url.searchParams.delete('category');
            } else {
                url.searchParams.set('category', category);
            }
            window.history.pushState({}, '', url);

            renderJobs(allJobs);
            updateFilterButtons();
            updateStats();
        }

        function toggleDeadlineFilter() {
            showOnlyDeadlineToday = !showOnlyDeadlineToday;
            if (showOnlyDeadlineToday) showOnlyNew = false; // ìƒí˜¸ ë°°íƒ€ì 

            // URL ì—…ë°ì´íŠ¸
            const url = new URL(window.location);
            if (showOnlyDeadlineToday) {
                url.searchParams.set('filter', 'deadline');
            } else {
                url.searchParams.delete('filter');
            }
            window.history.pushState({}, '', url);

            renderJobs(allJobs);
            updateFilterButtons();
            updateStats();
        }

        function toggleNewFilter() {
            showOnlyNew = !showOnlyNew;
            if (showOnlyNew) showOnlyDeadlineToday = false; // ìƒí˜¸ ë°°íƒ€ì 

            // URL ì—…ë°ì´íŠ¸
            const url = new URL(window.location);
            if (showOnlyNew) {
                url.searchParams.set('filter', 'new');
            } else {
                url.searchParams.delete('filter');
            }
            window.history.pushState({}, '', url);

            renderJobs(allJobs);
            updateFilterButtons();
            updateStats();
        }

        function filterByPlatform(platform) {
            currentPlatform = platform;

            // URL ì—…ë°ì´íŠ¸
            const url = new URL(window.location);
            if (platform === 'all') {
                url.searchParams.delete('platform');
            } else {
                url.searchParams.set('platform', platform);
            }
            window.history.pushState({}, '', url);

            renderJobs(allJobs);
            updateFilterButtons();
            updateStats();
        }

        function updateFilterButtons() {
            // ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.filter-btn[data-category]').forEach(btn => {
                const btnCategory = btn.dataset.category;
                if (btnCategory === currentCategory) {
                    btn.classList.add('active');
                    btn.classList.remove('bg-gray-200', 'text-gray-700');

                    // ì¹´í…Œê³ ë¦¬ë³„ ìƒ‰ìƒ ì ìš©
                    if (btnCategory === 'all') {
                        btn.classList.add('bg-gradient-to-r', 'from-blue-600', 'to-purple-600', 'text-white');
                    } else if (btnCategory === 'data') {
                        btn.classList.add('bg-blue-600', 'text-white');
                    } else if (btnCategory === 'accounting') {
                        btn.classList.add('bg-green-600', 'text-white');
                    } else if (btnCategory === 'hr') {
                        btn.classList.add('bg-orange-600', 'text-white');
                    }
                } else {
                    btn.classList.remove('active', 'bg-gradient-to-r', 'from-blue-600', 'to-purple-600',
                        'bg-blue-600', 'bg-green-600', 'bg-orange-600', 'text-white');
                    btn.classList.add('bg-gray-200', 'text-gray-700');
                }
            });

            // ì˜¤ëŠ˜ ë§ˆê° ë²„íŠ¼ ì—…ë°ì´íŠ¸
            const deadlineBtn = document.getElementById('btn-deadline');
            if (deadlineBtn) {
                if (showOnlyDeadlineToday) {
                    deadlineBtn.classList.add('active', 'bg-red-600', 'text-white');
                    deadlineBtn.classList.remove('bg-gray-200', 'text-gray-700');
                } else {
                    deadlineBtn.classList.remove('active', 'bg-red-600', 'text-white');
                    deadlineBtn.classList.add('bg-gray-200', 'text-gray-700');
                }
            }

            // ì‹ ê·œ ë²„íŠ¼ ì—…ë°ì´íŠ¸
            const newBtn = document.getElementById('btn-new');
            if (newBtn) {
                if (showOnlyNew) {
                    newBtn.classList.add('active', 'bg-green-600', 'text-white');
                    newBtn.classList.remove('bg-gray-200', 'text-gray-700');
                } else {
                    newBtn.classList.remove('active', 'bg-green-600', 'text-white');
                    newBtn.classList.add('bg-gray-200', 'text-gray-700');
                }
            }

            // í”Œë«í¼ ë²„íŠ¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.filter-btn[data-platform]').forEach(btn => {
                const btnPlatform = btn.dataset.platform;
                if (btnPlatform === currentPlatform) {
                    btn.classList.add('active', 'bg-indigo-600', 'text-white');
                    btn.classList.remove('bg-gray-200', 'text-gray-700');
                } else {
                    btn.classList.remove('active', 'bg-indigo-600', 'text-white');
                    btn.classList.add('bg-gray-200', 'text-gray-700');
                }
            });
        }

        function updateStats() {
            const filteredJobs = currentCategory === 'all'
                ? allJobs
                : allJobs.filter(job => getJobCategory(job) === currentCategory);

            const total = filteredJobs.length;
            const newCount = filteredJobs.filter(j => j.is_new).length;
            const deadlineCount = filteredJobs.filter(j => checkDeadline(j.deadline)).length;

            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-new').textContent = newCount;
            document.getElementById('stat-deadline').textContent = deadlineCount;
        }

        function renderJobs(jobs) {
            const list = document.getElementById('job-list');
            list.innerHTML = '';

            // í˜„ì¬ ì¹´í…Œê³ ë¦¬ë¡œ í•„í„°ë§
            let filteredJobs = currentCategory === 'all'
                ? jobs
                : jobs.filter(job => getJobCategory(job) === currentCategory);

            // ì˜¤ëŠ˜ ë§ˆê° í•„í„° ì ìš©
            if (showOnlyDeadlineToday) {
                filteredJobs = filteredJobs.filter(job => checkDeadline(job.deadline));
            }

            // í”Œë«í¼ í•„í„° ì ìš©
            if (currentPlatform !== 'all') {
                filteredJobs = filteredJobs.filter(job => job.site === currentPlatform);
            }

            // ì‹ ê·œ í•„í„° ì ìš©
            if (showOnlyNew) {
                filteredJobs = filteredJobs.filter(job => job.is_new);
            }

            if (filteredJobs.length === 0) {
                list.innerHTML = `
                    <div class="text-center text-gray-500 py-10">
                        <p class="text-2xl mb-2">ğŸ“­</p>
                        <p>í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            filteredJobs.forEach(job => {
                const isDeadline = checkDeadline(job.deadline);
                const isNew = job.is_new;
                const jobCategory = getJobCategory(job);

                const card = document.createElement('div');
                card.className = `job-card bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition border-l-4 ${isDeadline ? 'border-red-500' : (isNew ? 'border-green-500' : 'border-gray-200')} animate-fadeIn`;
                card.dataset.category = jobCategory;

                let badges = '';
                if (isDeadline) badges += `<span class="bg-red-100 text-red-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded">ì˜¤ëŠ˜ ë§ˆê°</span>`;
                if (isNew) badges += `<span class="bg-green-100 text-green-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded">ì‹ ê·œ</span>`;

                // ì¹´í…Œê³ ë¦¬ ë±ƒì§€
                const categoryColors = {
                    'data': 'bg-blue-100 text-blue-800',
                    'accounting': 'bg-emerald-100 text-emerald-800',
                    'hr': 'bg-orange-100 text-orange-800',
                    'other': 'bg-gray-100 text-gray-800'
                };
                const categoryNames = {
                    'data': 'ë°ì´í„°',
                    'accounting': 'íšŒê³„',
                    'hr': 'ì¸ì‚¬',
                    'other': 'ê¸°íƒ€'
                };
                badges += `<span class="${categoryColors[jobCategory]} text-xs font-semibold px-2.5 py-0.5 rounded">${categoryNames[jobCategory]}</span>`;

                const analysis = job.ai_analysis || {};
                const strategy = analysis.cover_letter_strategy || "ë¶„ì„ ëŒ€ê¸° ì¤‘...";

                card.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            ${badges}
                            <h2 class="text-xl font-bold text-gray-900 mt-2">${job.title}</h2>
                            <p class="text-gray-600 font-medium">${job.company} | ${job.site}</p>
                            <p class="text-sm text-gray-400 mt-1">ë§ˆê°ì¼: ${job.deadline}</p>
                        </div>
                        <a href="${job.link}" target="_blank" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 text-sm">ê³µê³  ë³´ê¸°</a>
                    </div>
                    
                    <div class="mt-4 pt-4 border-t border-gray-100">
                        <details class="group">
                            <summary class="flex justify-between items-center font-medium cursor-pointer list-none">
                                <span class="text-purple-600">âœ¨ AI ìì†Œì„œ ì „ëµ ë³´ê¸°</span>
                                <span class="transition group-open:rotate-180">
                                    <svg fill="none" height="24" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="24"><path d="M6 9l6 6 6-6"></path></svg>
                                </span>
                            </summary>
                            <div class="text-gray-600 mt-3 group-open:animate-fadeIn text-sm whitespace-pre-line bg-gray-50 p-3 rounded">
                                ${typeof strategy === 'string' ? strategy : JSON.stringify(strategy, null, 2)}
                            </div>
                        </details>
                    </div>
                `;
                list.appendChild(card);
            });
        }

        function checkDeadline(deadlineStr) {
            if (!deadlineStr) return false;

            const today = new Date();
            const todayMonth = String(today.getMonth() + 1).padStart(2, '0');
            const todayDate = String(today.getDate()).padStart(2, '0');

            // ë‹¤ì–‘í•œ ë‚ ì§œ í˜•ì‹ ì§€ì›
            const todayFormats = [
                `${todayMonth}.${todayDate}`,      // 02.02
                `${todayMonth}/${todayDate}`,      // 02/02
                `${todayMonth}-${todayDate}`,      // 02-02
                `-${todayMonth}-${todayDate}`      // 2026-02-02 í˜•ì‹ ì¼ë¶€ ë§¤ì¹­
            ];

            const lowerDeadline = deadlineStr.toLowerCase();

            // "ì˜¤ëŠ˜" í‚¤ì›Œë“œ ì²´í¬
            if (lowerDeadline.includes('ì˜¤ëŠ˜') || lowerDeadline.includes('today')) {
                return true;
            }

            // ë‹¤ì–‘í•œ í˜•ì‹ìœ¼ë¡œ ì˜¤ëŠ˜ ë‚ ì§œ ì²´í¬
            for (const fmt of todayFormats) {
                if (deadlineStr.includes(fmt)) {
                    return true;
                }
            }

            return false;
        }

        // ë‚´ì¼ ë§ˆê° ì²´í¬ í•¨ìˆ˜ ì¶”ê°€
        function checkDeadlineTomorrow(deadlineStr) {
            if (!deadlineStr) return false;

            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);

            const tomorrowMonth = String(tomorrow.getMonth() + 1).padStart(2, '0');
            const tomorrowDate = String(tomorrow.getDate()).padStart(2, '0');

            const tomorrowFormats = [
                `${tomorrowMonth}.${tomorrowDate}`,
                `${tomorrowMonth}/${tomorrowDate}`,
                `${tomorrowMonth}-${tomorrowDate}`,
                `-${tomorrowMonth}-${tomorrowDate}`
            ];

            const lowerDeadline = deadlineStr.toLowerCase();

            // "ë‚´ì¼" í‚¤ì›Œë“œ ì²´í¬
            if (lowerDeadline.includes('ë‚´ì¼') || lowerDeadline.includes('tomorrow')) {
                return true;
            }

            // ë‹¤ì–‘í•œ í˜•ì‹ìœ¼ë¡œ ë‚´ì¼ ë‚ ì§œ ì²´í¬
            for (const fmt of tomorrowFormats) {
                if (deadlineStr.includes(fmt)) {
                    return true;
                }
            }

            return false;
        }

        window.onload = loadJobs;
    </script>
</head>

<body class="bg-gray-100 min-h-screen">
    <div class="max-w-4xl mx-auto py-10 px-4">
        <header class="mb-8 text-center">
            <h1
                class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600">
                Job Scout AI
            </h1>
            <p class="text-gray-500 mt-2">ë§¤ì¼ ì•„ì¹¨ ë°°ë‹¬ë˜ëŠ” ë§ì¶¤í˜• ì±„ìš© ë¸Œë¦¬í•‘</p>
        </header>

        <!-- í†µê³„ ì¹´ë“œ (í´ë¦­ ê°€ëŠ¥) -->
        <div class="grid grid-cols-3 gap-4 mb-6">
            <div onclick="showOnlyNew=false; showOnlyDeadlineToday=false; renderJobs(allJobs); updateFilterButtons(); updateStats();"
                class="bg-white rounded-lg p-4 text-center shadow cursor-pointer hover:shadow-lg transition">
                <p class="text-2xl font-bold text-gray-800" id="stat-total">0</p>
                <p class="text-sm text-gray-500">ì „ì²´ ê³µê³ </p>
            </div>
            <div onclick="toggleNewFilter()"
                class="bg-white rounded-lg p-4 text-center shadow cursor-pointer hover:shadow-lg transition">
                <p class="text-2xl font-bold text-green-600" id="stat-new">0</p>
                <p class="text-sm text-gray-500">ì‹ ê·œ ê³µê³ </p>
            </div>
            <div onclick="toggleDeadlineFilter()"
                class="bg-white rounded-lg p-4 text-center shadow cursor-pointer hover:shadow-lg transition">
                <p class="text-2xl font-bold text-red-600" id="stat-deadline">0</p>
                <p class="text-sm text-gray-500">ì˜¤ëŠ˜ ë§ˆê°</p>
            </div>
        </div>

        <!-- ì¹´í…Œê³ ë¦¬ í•„í„° ë²„íŠ¼ -->
        <div class="flex flex-wrap justify-center gap-3 mb-4">
            <button onclick="filterByCategory('all')" data-category="all"
                class="filter-btn px-5 py-2.5 rounded-full font-medium shadow-sm hover:shadow-md">
                ğŸ¯ ì „ì²´
            </button>
            <button onclick="filterByCategory('data')" data-category="data"
                class="filter-btn px-5 py-2.5 rounded-full font-medium shadow-sm hover:shadow-md bg-gray-200 text-gray-700">
                ğŸ’¾ ë°ì´í„°
            </button>
            <button onclick="filterByCategory('accounting')" data-category="accounting"
                class="filter-btn px-5 py-2.5 rounded-full font-medium shadow-sm hover:shadow-md bg-gray-200 text-gray-700">
                ğŸ“Š íšŒê³„
            </button>
            <button onclick="filterByCategory('hr')" data-category="hr"
                class="filter-btn px-5 py-2.5 rounded-full font-medium shadow-sm hover:shadow-md bg-gray-200 text-gray-700">
                ğŸ‘¥ ì¸ì‚¬
            </button>
        </div>

        <!-- ìƒíƒœ í•„í„° ë²„íŠ¼ -->
        <div class="flex flex-wrap justify-center gap-3 mb-8">
            <button onclick="toggleDeadlineFilter()" id="btn-deadline"
                class="filter-btn px-5 py-2.5 rounded-full font-medium shadow-sm hover:shadow-md bg-gray-200 text-gray-700">
                ğŸ”¥ ì˜¤ëŠ˜ ë§ˆê°
            </button>
            <button onclick="toggleNewFilter()" id="btn-new"
                class="filter-btn px-5 py-2.5 rounded-full font-medium shadow-sm hover:shadow-md bg-gray-200 text-gray-700">
                âœ¨ ì‹ ê·œ
            </button>
        </div>

        <!-- í”Œë«í¼ í•„í„° ë²„íŠ¼ -->
        <div class="flex flex-wrap justify-center gap-2 mb-8">
            <span class="text-gray-500 text-sm mr-2 self-center">í”Œë«í¼:</span>
            <button onclick="filterByPlatform('all')" data-platform="all"
                class="filter-btn px-4 py-1.5 rounded-full text-sm font-medium shadow-sm hover:shadow-md bg-indigo-600 text-white">
                ğŸŒ ì „ì²´
            </button>
            <button onclick="filterByPlatform('JobKorea')" data-platform="JobKorea"
                class="filter-btn px-4 py-1.5 rounded-full text-sm font-medium shadow-sm hover:shadow-md bg-gray-200 text-gray-700">
                ğŸŸ¦ ì¡ì½”ë¦¬ì•„
            </button>
            <button onclick="filterByPlatform('Linkareer')" data-platform="Linkareer"
                class="filter-btn px-4 py-1.5 rounded-full text-sm font-medium shadow-sm hover:shadow-md bg-gray-200 text-gray-700">
                ğŸŸ© ë§ì»¤ë¦¬ì–´
            </button>
            <button onclick="filterByPlatform('Incruit')" data-platform="Incruit"
                class="filter-btn px-4 py-1.5 rounded-full text-sm font-medium shadow-sm hover:shadow-md bg-gray-200 text-gray-700">
                ğŸŸ§ ì¸í¬ë£¨íŠ¸
            </button>
            <button onclick="filterByPlatform('Saramin')" data-platform="Saramin"
                class="filter-btn px-4 py-1.5 rounded-full text-sm font-medium shadow-sm hover:shadow-md bg-gray-200 text-gray-700">
                ğŸŸ¥ ì‚¬ëŒì¸
            </button>
            <button onclick="filterByPlatform('Wanted')" data-platform="Wanted"
                class="filter-btn px-4 py-1.5 rounded-full text-sm font-medium shadow-sm hover:shadow-md bg-gray-200 text-gray-700">
                ğŸŸª ì›í‹°ë“œ
            </button>
        </div>

        <div id="job-list" class="space-y-4">
            <!-- Jobs will be injected here -->
            <div class="text-center text-gray-500 py-10">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
                <p class="mt-4">ë°ì´í„° ë¡œë”© ì¤‘...</p>
            </div>
        </div>

        <footer class="mt-12 text-center text-gray-400 text-sm">
            Automated by Job Scout Serverless
        </footer>
    </div>
</body>

</html>